---
title: Contract 취약성 검사
date: 2021-10-28 15:00:00
category: blockchain
draft: false
---

Securify2 를 이용해서 Contract 의 취약성을 검사해보자.

사용할 라이브러리는 다음과 같다. 그리고 도커가 필요하다.

- https://www.npmjs.com/package/truffle-flattener
- https://github.com/eth-sri/securify2

## Flattener

보통 컨트랙트는 여러 컨트랙트를 import 하여 사용하고 있다. 이때 취약성 검사를 하기 위해서는 이것들을 하나의 파일로 모아주어야 한다.

그러기 위해서 https://www.npmjs.com/package/truffle-flattener 라이브러리를 이용하자.

### Npm Flattener Install

```shell
npm install truffle-flattener -g
```

### Use Flattener

아래 명령어를 통해서 contracts 하위에 있는 testContract.sol 파일을 flat 폴더 하위에 flatContract.sol 파일로 flat 하게 만들어준다.

```shell
truffle-flattener contracts/testContract.sol > flat/flatContract.sol
```

이렇게 취약성 검사를 할 하나의 컨트랙틀 만드는게 우선이다.

## Securify2

이제 Securify2 를 이용해서 취약성 검사를 하자.

### Install Securify & build docker image

Securify2 를 사용할 방법은 여러가지가 있지만 Docker 를 활용하는게 깔끔하다.

```shell
git clone https://github.com/eth-sri/securify2
cd securify2
docker build -t securify .
```

### Run Securify2 using docker image

다음 커맨드를 사용해서 취약성 검사를하면 결과값이 나오게 된다.
이때 contract dir full path 는 절대 경로를 넣어줘야한다. 상대 경로를 넣으면 에러가 난다.

```shell
docker run -it -v <contract-dir-full-path>:/share securify /share/<contract>.sol
```
