---
title: JPA - 연관관계
date: 2020-10-12 14:10:44
category: java
draft: false
---

## 일대다

일대다 다대일 관계에서 항상 외래키는 다가 가지고 있다.

연관관계의 주인인 곳의 데이터를 수정해야 실제 DB 에 반영이 된다.

Team 에 addMember 를 한다고 해서 DB 에 반영이 되지 않는 다는 것이다.

### 일대다 단방향의 단점

외래키가 다른 테이블에 있다. 본인 테이블에 외래 키가 있으면 엔티티의 저장과 연관관계 처리를 INSERT SQL 한 번으로 끝낼 수 있지만, 다른 테이블에 외래키가 있어 연관관계 처리를 위한 UPDATE SQL 을 아래와 같이 추가로 실행해야 한다.

```sql
insert into Member ...
insert into Member ...
insert into Member ...

insert into Team ...

update Member set TEAM_ID=? ...

update Member set TEAM_ID=? ...
```

따라서 일대다 단방퍙 매핑보다는 다대일 양방향 매핑을 사용하는 것이 좋다.

일대다 단방향 매핑을 사용하면 엔티티를 매핑한 테이블이 아닌 다른 테이블의 외래 키를 관리해야 한다. 이것은 성능 문제도 있지만 관리도 부담스럽다.

## 단방향과 양방향

단방향은 신경쓸 것이 딱히 없다.

양방향은 외래 키가 있는 쪽이 연관관계의 주인이다. 즉, Member 에 외래 키가 있고 연관관계의 주인이라 할 수 있다.

앙방향의 장점은 두 엔티티 객체에서 연관 객체의 데이터를 조회할 수 있다는 것이다.

그리고 항상 서로를 참조해야하기 때문에, 연관관계 편의 메소드를 작성해주어야 한다.
addMember, setTeam 과 같은 것들이 있다. 또한 무한루프에 빠지기 않기 하기 위한 로직을 작성해 주어야 한다.

## One to One

1:1 관계에서는 주 테이블과 대상 테이블에 외래키가 있을 수 있다.

주 테이블에 외래키가 있으면 객체지향 개발자에게 편리하다. 주 테이블만 보면 해당 테이블과 대상 테이블과 연관관계가 있다는 것을 알 수 있기 때문이다.

대상 테이블에 외래키가 있으면 데이터베이스 개발자에게 편리하다. 그 이유는 일대일에서 일대다로 변경할 때 테이블 구조를 변경할 필요 없이 유지할 수 있기 때문이다.

ex) Member 와 Locker 가 있을 때 외래키가 Locker 에게 있으면 일대다가 되어 Locker 가 많아져도 테이블 구조를 변경할 필요가 없다.

## References

[자바 ORM 표준 JPA 프로그래밍](https://www.aladin.co.kr/shop/wproduct.aspx?itemid=62681446)
