---
title: Effective Java
date: 2021-05-21 20:00:00
category: java
draft: false
---

## 15. 변경 가능성을 최소화 하라

변경 불가능한 클래스를 만드는 5가지 규칙

1. 수정자와 같은 객체 상태를 변경하는 메소드를 제공하지 않는다.
2. 상속할 수 없도록 한다. 악의적인 하위 클래스가 객체 상태가 변경된 것처럼 동작해서 변경 불가능성을 깨뜨릴 수 있기 때문이다. 계승을 금지하기 위해선 class 를 final로 선언하거나, 생성자를 private, package-private으로 선언하면 된다.
3. 모든 필드를 final 로 선언한다.
4. 모든 필드를 private 로 선언한다.
5. 변경 가능 컴포넌트에 대한 독점적 접근권을 보장한다.

```java
public final class Complex {
		private final double re;
		private final double im;

		public Complex(double re, double im) {
				this.re = re;
				this.im = im;
		}

		public Complex add(Complex c) {
				return new Complex(re + c.re, im + c.im);
		}
}
```

변경 불가능한 클래스가 따르는 패턴은, this 객체를 변경하는 대신 새로운 객체를 만들어 반환한다.

functional approach 로 알려져 있고, 변경 불가능성을 보장하므로 장점이 많다.

- 변경 불가능 객체는 단순하다.
- 안정적으로 사용할 수 있다.
- Thread Safe하다 → 자유롭게 공유할 수 있다.
- clone method나 복사 생성자를 만들 필요가 없다. (어차피 똑같으니까)
- 처음 클래스를 설계할 때 public 생성자 대신 정적 팩토리 메소드를 제공하여, 클라이언트 코드를 수정하지 않고 자주 사용되는 객체 대해서는 캐싱을 제공할 수 있다. 따라서 메모리와 쓰레기 수집 비용이 줄어든다.

**변경 불가능한 클래스로 구현하는 것이 어려운 클래스도 있다. 그렇다면 최대한 변경 가능성을 제한해라. 그러면 객체 상태를 추론하기 쉬워지고 오류도 줄어든다. 따라서 가능하면 모든 field는 final로 선언하라.**

## 16. 계승하는 대신 구성하라 (17)

상속은 코드의 재사용을 돕지만, 항상 최선이라고 할 수 없다. 상속은 캡슐화 원칙을 위반한다. 왜냐면 상위 클래스의 구현이 릴리즈에 따라 변경되면서 하위 클래스의 구현이 깨질 수 있기 때문이다.

따라서 상속을 사용하기 위한 조건은, 개발자가 상속을 고려해 설계하고 그에 맞는 문서를 갖추는 것이다. **그렇지 않은 클래스는 상속하지 않는 것이 좋다.**

상속을 금지하기 위한 방법은, 클래스를 final로 선언하거나, 모든 생성자를 private, package-private 으로 선언하고 대신 public 정적 메소드를 선언하는 것이다.

그리고 상속을 회피하고 비슷한 효과를 내는 방법은 상속하고 싶은 클래스의 private instance 변수를 하나 두는 것이다. 이러한 설계 기법을 구성(composition)이라 부른다.
